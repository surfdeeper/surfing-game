# Energy Field Propagation

The energy field uses a row-blending algorithm to propagate energy from
horizon (row 0) toward shore (row N). Each frame, cells blend with the
row above them at a rate determined by `travelDuration`.

## No Damping (Deep Water)

In deep water with `depthDampingCoefficient=0`, energy maintains its
magnitude as it travels. The pulse spreads vertically due to blending
but total energy is conserved.

import { PROGRESSION_NO_DAMPING } from '../../src/state/energyFieldPropagation.test.js';
import { ProgressionStrip, ProgressionPlayer } from '../components/Visuals.jsx';

<ProgressionStrip snapshots={PROGRESSION_NO_DAMPING} />

<ProgressionPlayer snapshots={PROGRESSION_NO_DAMPING} />

**Key observations:**
- Row 0 starts at 1.0, fades as energy moves down
- By t=3s, energy band is centered around rows 2-3
- Total energy remains roughly constant across frames

---

## With Depth-Based Damping

Setting `depthDampingCoefficient=0.1` causes energy to decay faster in
shallow water. The formula is:

```
energy *= exp(-coefficient * dt / depth^exponent)
```

Where:
- `coefficient` controls overall decay rate (0.1 = moderate)
- `exponent` controls how sharply decay ramps near shore (2.0 = quadratic)
- `depth` decreases from 10m at horizon to 0.5m at shore

import { PROGRESSION_WITH_DAMPING } from '../../src/state/energyFieldPropagation.test.js';

<ProgressionStrip snapshots={PROGRESSION_WITH_DAMPING} />

<ProgressionPlayer snapshots={PROGRESSION_WITH_DAMPING} />

Notice how energy fades as it approaches shore (bottom rows). This
prevents energy from "piling up" at the shoreline.

---

## High Damping

Doubling the coefficient to `0.2` causes more aggressive decay:

import { PROGRESSION_HIGH_DAMPING } from '../../src/state/energyFieldPropagation.test.js';

<ProgressionStrip snapshots={PROGRESSION_HIGH_DAMPING} />

<ProgressionPlayer snapshots={PROGRESSION_HIGH_DAMPING} />

---

## Damping Coefficient Comparison

| Coefficient | Effect |
|-------------|--------|
| 0.0 | No decay - energy reaches shore at full strength |
| 0.1 | Moderate decay - energy reduced but visible near shore |
| 0.2 | Aggressive decay - energy mostly gone before reaching shore |

**Tradeoff:** Too much damping makes waves feel weak; too little causes
visual artifacts at the shoreline.

---

## Energy Drain (Wave Breaking)

When a wave breaks, `drainEnergyAt()` removes energy from the field at
that location. The drained energy is converted to foam via the
`energyTransferGrid`.

```js
// Drain energy at normalized position (x, y)
const drained = drainEnergyAt(field, 0.5, 0.5, amount);
// Returns actual amount drained (may be less if insufficient energy)
```

This progression shows energy propagating normally, then at t=1s the
center column is completely drained (simulating wave breaking):

import { PROGRESSION_WITH_DRAIN } from '../../src/state/energyFieldPropagation.test.js';

<ProgressionStrip snapshots={PROGRESSION_WITH_DRAIN} />

<ProgressionPlayer snapshots={PROGRESSION_WITH_DRAIN} />

**What to look for:**
- t=0s: Full energy pulse at horizon
- t=1s (drain): Center column drops to 0, neighbors retain energy
- t=2s+: Hole persists as energy continues propagating

The contrast between center (0.0) and neighbors (0.3-0.5) demonstrates
how breaking creates localized energy depletion.

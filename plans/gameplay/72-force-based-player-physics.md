# Plan 72: Force-Based Player Physics

## Purpose

Replace the current velocity-targeting system with proper force-based physics to create more satisfying, "alive" movement with momentum and glide.

---

## Current Problem

The current system uses **velocity targeting**:
```javascript
targetVelocity = input * speed
actualVelocity = lerp(actualVelocity, targetVelocity, accelFactor)
```

This feels "dead" because:
- No momentum - velocity always seeks the target
- No glide - letting go immediately starts deceleration toward zero
- Acceleration/deceleration are coupled
- No natural terminal velocity
- Forces aren't separable (can't feel drag vs thrust independently)

---

## Proposed System

### Core Physics Loop

```javascript
// 1. Accumulate forces
let forceX = 0, forceY = 0;

// Paddle thrust (player input)
if (input.up) forceY -= paddleForce;
if (input.down) forceY += paddleForce;
if (input.left) forceX -= paddleForce;
if (input.right) forceX += paddleForce;

// Drag (opposes velocity)
const speed = Math.sqrt(vx*vx + vy*vy);
if (speed > 0) {
    const dragMagnitude = dragCoeff * speed * speed; // Quadratic
    forceX -= (vx / speed) * dragMagnitude;
    forceY -= (vy / speed) * dragMagnitude;
}

// Foam push (constant shoreward force)
if (inFoam) {
    forceY += foamPushForce * foamIntensity;
}

// 2. Apply acceleration (F = ma, so a = F/m)
const ax = forceX / mass;
const ay = forceY / mass;

// 3. Update velocity
vx += ax * dt;
vy += ay * dt;

// 4. Update position
x += vx * dt;
y += vy * dt;
```

### Terminal Velocity

With quadratic drag, terminal velocity emerges naturally:

```
At terminal velocity: paddleForce = dragCoeff * v²
Therefore: v_terminal = sqrt(paddleForce / dragCoeff)
```

This means we can tune `paddleForce` and `dragCoeff` to achieve desired max speeds.

---

## Parameters

### Player Properties

| Parameter | Description | Suggested Default |
|-----------|-------------|-------------------|
| `mass` | Resistance to acceleration. Higher = sluggish, lower = twitchy | 1.0 |
| `paddleForce` | Thrust generated by paddling | 80 |

### Water Properties

| Parameter | Description | Suggested Default |
|-----------|-------------|-------------------|
| `waterDrag` | Drag coefficient in calm water | 0.02 |
| `shoreDrag` | Drag coefficient on shore (lower = slidey) | 0.01 |

### Foam/Whitewater Properties

| Parameter | Description | Suggested Default |
|-----------|-------------|-------------------|
| `foamDrag` | Drag coefficient in foam (higher = sluggish) | 0.05 |
| `foamPushForce` | Constant force pushing toward shore | 40 |

### Derived Behaviors

With these defaults:
- **Calm water terminal velocity**: sqrt(80 / 0.02) ≈ 63 px/s
- **Foam terminal velocity**: sqrt(80 / 0.05) ≈ 40 px/s
- **Glide distance**: Depends on drag, lower drag = longer glide

---

## Zone Behaviors

### Shore
- Low drag → snappy, responsive
- No push force
- High paddle force (walking is easier than swimming)

### Calm Water
- Medium drag → smooth glide
- No push force
- Medium paddle force

### Foam (Whitewater)
- High drag → sluggish, turbulent feel
- Push force toward shore (proportional to intensity)
- Same paddle force (you're trying just as hard!)

---

## Debug Panel Controls (with Tooltips)

Replace current sliders with force-based parameters:

| Control | Tooltip |
|---------|---------|
| **Paddle Force** | "How hard you can paddle. Higher = faster acceleration and higher top speed." |
| **Water Drag** | "Resistance in calm water. Higher = slower top speed but quicker stopping." |
| **Foam Drag** | "Extra resistance in whitewater. Makes foam feel thick and turbulent." |
| **Foam Push** | "Force pushing you toward shore when in foam. Higher = harder to hold position." |
| **Mass** | "Resistance to acceleration. Higher = sluggish but stable. Lower = twitchy." |

---

## Implementation Steps

### Step 1: Add Tooltips to Current UI
- [ ] Create `Tooltip` component or add `title` attribute to sliders
- [ ] Document what each current slider does (even if we're replacing them)

### Step 2: Refactor Physics Model
- [ ] Replace velocity-targeting with force accumulation
- [ ] Implement quadratic drag
- [ ] Add zone-based drag coefficients
- [ ] Keep foam push force (already exists conceptually)

### Step 3: Update Debug Panel
- [ ] Replace sliders with new force-based parameters
- [ ] Add tooltips explaining each parameter
- [ ] Show derived values (current speed, terminal velocity)

### Step 4: Tune and Test
- [ ] Update balance tests for new physics model
- [ ] Tune parameters until movement feels good
- [ ] Verify: glide when releasing input
- [ ] Verify: natural terminal velocity
- [ ] Verify: foam feels different from calm water

---

## Success Criteria

1. **Glide**: Letting go of input results in gradual deceleration, not instant stop
1. **Terminal velocity**: Holding input reaches a max speed, can't accelerate forever
1. **Zone feel**: Shore, water, and foam feel distinctly different
1. **Foam struggle**: Must paddle hard to make progress, pushed back when idle
1. **Intuitive controls**: Debug sliders map to understandable physical properties

---

## What This Enables (Future)

- Currents (constant lateral force)
- Wave push (force when wave passes)
- Catching waves (accelerate with wave energy)
- Different board stats (mass, drag profiles)
- Wind effects
